<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>School Announcements Admin Panel</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script><!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body {
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
        }
        
        .admin-gradient {
            background: linear-gradient(135deg, #1e293b 0%, #334155 25%, #475569 50%, #64748b 75%, #94a3b8 100%);
            position: relative;
            overflow: hidden;
        }
        
        .admin-gradient::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.9) 0%, rgba(79, 70, 229, 0.8) 100%);
            z-index: 1;
        }
        
        .admin-content {
            position: relative;
            z-index: 2;
        }
        
        .admin-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(255, 255, 255, 0.05);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .admin-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 32px 64px -12px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(99, 102, 241, 0.1);
        }
        
        .admin-button {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .admin-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px -5px rgba(99, 102, 241, 0.5);
        }
        
        .admin-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .admin-input {
            border: 2px solid #e2e8f0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.9);
        }
        
        .admin-input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
            background: rgba(255, 255, 255, 1);
        }
        
        .priority-urgent {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .priority-important {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .priority-general {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }
        
        .priority-event {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .announcement-item {
            border-left: 4px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        
        .announcement-item.urgent {
            border-left-color: #ef4444;
        }
        
        .announcement-item.important {
            border-left-color: #f59e0b;
        }
        
        .announcement-item.general {
            border-left-color: #3b82f6;
        }
        
        .announcement-item.event {
            border-left-color: #10b981;
        }
        
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .success-message {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            box-shadow: 0 10px 25px -5px rgba(16, 185, 129, 0.4);
        }
        
        .error-message {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            box-shadow: 0 10px 25px -5px rgba(239, 68, 68, 0.4);
        }
        
        .stats-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 1px solid #e2e8f0;
        }
        
        .modal-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="bg-gray-50 min-h-full"><!-- Header -->
  <header class="admin-gradient text-white">
   <div class="admin-content">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
     <div class="text-center">
      <div class="flex items-center justify-center mb-6">
       <div class="w-16 h-16 bg-white bg-opacity-20 backdrop-filter backdrop-blur-lg rounded-2xl flex items-center justify-center mr-4">
        <svg class="h-8 w-8 text-white" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
        </svg>
       </div>
       <div class="text-left">
        <h1 id="admin-title" class="text-3xl md:text-4xl font-bold tracking-tight">Announcements Admin Panel</h1>
        <p id="school-name" class="text-lg text-indigo-100 font-medium">Dr. Alfredo Pio De Roda School</p>
       </div>
      </div>
      <p class="text-xl text-indigo-100 max-w-2xl mx-auto">Manage school announcements, create new posts, and keep your community informed</p>
     </div>
    </div>
   </div>
  </header><!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12"><!-- Stats Overview -->
   <div class="grid md:grid-cols-4 gap-6 mb-12">
    <div class="stats-card p-6 rounded-2xl">
     <div class="flex items-center">
      <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mr-4">
       <svg class="h-6 w-6 text-blue-600" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
       </svg>
      </div>
      <div>
       <p class="text-2xl font-bold text-gray-800" id="total-count">0</p>
       <p class="text-sm text-gray-600">Total Announcements</p>
      </div>
     </div>
    </div>
    <div class="stats-card p-6 rounded-2xl">
     <div class="flex items-center">
      <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center mr-4">
       <svg class="h-6 w-6 text-green-600" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
       </svg>
      </div>
      <div>
       <p class="text-2xl font-bold text-gray-800" id="active-count">0</p>
       <p class="text-sm text-gray-600">Active Posts</p>
      </div>
     </div>
    </div>
    <div class="stats-card p-6 rounded-2xl">
     <div class="flex items-center">
      <div class="w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center mr-4">
       <svg class="h-6 w-6 text-red-600" fill="currentColor" viewbox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V19H11V17M11,5H13V15H11V5Z" />
       </svg>
      </div>
      <div>
       <p class="text-2xl font-bold text-gray-800" id="urgent-count">0</p>
       <p class="text-sm text-gray-600">Urgent Posts</p>
      </div>
     </div>
    </div>
    <div class="stats-card p-6 rounded-2xl">
     <div class="flex items-center">
      <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mr-4">
       <svg class="h-6 w-6 text-purple-600" fill="currentColor" viewbox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z" />
       </svg>
      </div>
      <div>
       <p class="text-2xl font-bold text-gray-800" id="recent-count">0</p>
       <p class="text-sm text-gray-600">This Week</p>
      </div>
     </div>
    </div>
   </div>
   <div class="grid lg:grid-cols-3 gap-8"><!-- Create New Announcement -->
    <div class="lg:col-span-1">
     <div class="admin-card p-8 rounded-2xl fade-in">
      <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
       <svg class="h-6 w-6 text-indigo-600 mr-2" fill="currentColor" viewbox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
       </svg> Create Announcement</h2>
      <div id="message-container"></div>
      <form id="announcement-form" class="space-y-6">
       <div><label for="title" class="block text-sm font-semibold text-gray-700 mb-2">Title *</label> <input type="text" id="title" name="title" class="admin-input w-full px-4 py-3 rounded-xl focus:outline-none" placeholder="Enter announcement title" required>
       </div>
       <div><label for="content" class="block text-sm font-semibold text-gray-700 mb-2">Content *</label> <textarea id="content" name="content" rows="4" class="admin-input w-full px-4 py-3 rounded-xl focus:outline-none" placeholder="Write your announcement content..." required></textarea>
       </div>
       <div><label for="priority" class="block text-sm font-semibold text-gray-700 mb-2">Priority *</label> <select id="priority" name="priority" class="admin-input w-full px-4 py-3 rounded-xl focus:outline-none" required> <option value="">Select Priority</option> <option value="urgent">üö® Urgent</option> <option value="important">‚≠ê Important</option> <option value="general">üì¢ General</option> <option value="event">üìÖ Event</option> </select>
       </div>
       <div><label class="flex items-center"> <input type="checkbox" id="active" name="active" checked class="w-5 h-5 text-indigo-600 border-2 border-gray-300 rounded focus:ring-indigo-500"> <span class="ml-3 text-sm font-medium text-gray-700">Publish immediately</span> </label>
       </div><button type="submit" id="submit-btn" class="admin-button w-full text-white py-4 px-6 rounded-xl font-bold text-lg flex items-center justify-center">
        <svg class="h-5 w-5 mr-2" fill="currentColor" viewbox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
        </svg> Create Announcement </button>
      </form>
     </div>
    </div><!-- Announcements List -->
    <div class="lg:col-span-2">
     <div class="admin-card p-8 rounded-2xl fade-in">
      <div class="flex items-center justify-between mb-6">
       <h2 class="text-2xl font-bold text-gray-800 flex items-center">
        <svg class="h-6 w-6 text-indigo-600 mr-2" fill="currentColor" viewbox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" />
        </svg> All Announcements</h2>
       <div class="flex items-center space-x-4"><select id="filter-priority" class="admin-input px-3 py-2 rounded-lg text-sm"> <option value="">All Priorities</option> <option value="urgent">Urgent</option> <option value="important">Important</option> <option value="general">General</option> <option value="event">Event</option> </select> <select id="filter-status" class="admin-input px-3 py-2 rounded-lg text-sm"> <option value="">All Status</option> <option value="active">Active</option> <option value="inactive">Inactive</option> </select>
       </div>
      </div><!-- Loading State -->
      <div id="loading-state" class="text-center py-12">
       <div class="loading-spinner mx-auto mb-4"></div>
       <p class="text-gray-600">Loading announcements...</p>
      </div><!-- Announcements List -->
      <div id="announcements-list" class="space-y-4 hidden"><!-- Announcements will be inserted here -->
      </div><!-- Empty State -->
      <div id="empty-state" class="text-center py-12 hidden">
       <svg class="h-16 w-16 text-gray-400 mx-auto mb-4" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
       </svg>
       <h3 class="text-lg font-semibold text-gray-800 mb-2">No Announcements Yet</h3>
       <p class="text-gray-600">Create your first announcement to get started!</p>
      </div>
     </div>
    </div>
   </div>
  </main><!-- Edit Modal -->
  <div id="edit-modal" class="fixed inset-0 modal-overlay flex items-center justify-center z-50 hidden">
   <div class="modal-content rounded-2xl p-8 max-w-2xl mx-4 w-full max-h-[90vh] overflow-y-auto">
    <div class="flex items-center justify-between mb-6">
     <h3 class="text-2xl font-bold text-gray-800">Edit Announcement</h3><button id="close-modal" class="text-gray-400 hover:text-gray-600">
      <svg class="h-6 w-6" fill="currentColor" viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
      </svg></button>
    </div>
    <form id="edit-form" class="space-y-6"><input type="hidden" id="edit-id">
     <div><label for="edit-title" class="block text-sm font-semibold text-gray-700 mb-2">Title *</label> <input type="text" id="edit-title" name="title" class="admin-input w-full px-4 py-3 rounded-xl focus:outline-none" required>
     </div>
     <div><label for="edit-content" class="block text-sm font-semibold text-gray-700 mb-2">Content *</label> <textarea id="edit-content" name="content" rows="4" class="admin-input w-full px-4 py-3 rounded-xl focus:outline-none" required></textarea>
     </div>
     <div><label for="edit-priority" class="block text-sm font-semibold text-gray-700 mb-2">Priority *</label> <select id="edit-priority" name="priority" class="admin-input w-full px-4 py-3 rounded-xl focus:outline-none" required> <option value="urgent">üö® Urgent</option> <option value="important">‚≠ê Important</option> <option value="general">üì¢ General</option> <option value="event">üìÖ Event</option> </select>
     </div>
     <div><label class="flex items-center"> <input type="checkbox" id="edit-active" name="active" class="w-5 h-5 text-indigo-600 border-2 border-gray-300 rounded focus:ring-indigo-500"> <span class="ml-3 text-sm font-medium text-gray-700">Active</span> </label>
     </div>
     <div class="flex space-x-4"><button type="submit" id="update-btn" class="admin-button flex-1 text-white py-3 px-6 rounded-xl font-bold"> Update Announcement </button> <button type="button" id="cancel-edit" class="bg-gray-500 hover:bg-gray-600 flex-1 text-white py-3 px-6 rounded-xl font-bold transition-colors"> Cancel </button>
     </div>
    </form>
   </div>
  </div>
  <script>
        // Firebase Configuration - REPLACE WITH YOUR ACTUAL CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyB6FAMgqHcccsqce4R5nd8y0YVggc3aHbY",
            authDomain: "clinique-parfum.firebaseapp.com",
            databaseURL: "https://clinique-parfum-default-rtdb.firebaseio.com",
            projectId: "clinique-parfum",
            storageBucket: "clinique-parfum.firebasestorage.app",
            messagingSenderId: "569473208892",
            appId: "1:569473208892:web:f009390a8631fc164ce939",
            measurementId: "G-XW3R3D64PR"
        };

        // Initialize Firebase
        let database;
        let isFirebaseInitialized = false;

        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            isFirebaseInitialized = true;
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.log("Firebase initialization failed - using Data SDK only:", error.message);
            isFirebaseInitialized = false;
        }

        // Data SDK implementation
        let currentData = [];
        let editingId = null;

        const dataHandler = {
            onDataChanged(data) {
                currentData = data;
                updateStats(data);
                renderAnnouncements(data);
                hideLoading();
            }
        };

        // Initialize Data SDK
        async function initializeApp() {
            try {
                // Wait for SDK to be available
                if (!window.dataSdk) {
                    showMessage('Data SDK not available. Please refresh the page.', 'error');
                    return;
                }
                
                const result = await window.dataSdk.init(dataHandler);
                if (!result.isOk) {
                    showMessage('Failed to initialize app: ' + result.error.message, 'error');
                }
            } catch (error) {
                showMessage('Failed to initialize app: ' + error.message, 'error');
            }
        }

        // Create new announcement
        document.getElementById('announcement-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submit-btn');
            const originalText = submitBtn.innerHTML;
            
            // Show loading state
            submitBtn.innerHTML = '<div class="loading-spinner mr-2"></div>Creating...';
            submitBtn.disabled = true;
            
            try {
                const formData = new FormData(e.target);
                const announcementData = {
                    announcement_title: formData.get('title').trim(),
                    announcement_content: formData.get('content').trim(),
                    announcement_priority: formData.get('priority'),
                    announcement_date: new Date().toISOString(),
                    announcement_active: formData.has('active')
                };

                // Check SDK availability
                if (!window.dataSdk) {
                    showMessage('Data SDK not available. Please refresh the page.', 'error');
                    return;
                }

                // Check data limit
                if (currentData.length >= 999) {
                    showMessage('Maximum limit of 999 announcements reached. Please delete some announcements first.', 'error');
                    return;
                }
                
                const result = await window.dataSdk.create(announcementData);
                
                if (result.isOk) {
                    showMessage('Announcement created successfully!', 'success');
                    e.target.reset();
                    document.getElementById('active').checked = true; // Reset to default
                } else {
                    showMessage('Failed to create announcement: ' + result.error.message, 'error');
                }
                
            } catch (error) {
                showMessage('Error creating announcement: ' + error.message, 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        // Edit announcement
        function editAnnouncement(id) {
            const announcement = currentData.find(item => item.__backendId === id);
            if (!announcement) return;
            
            editingId = id;
            document.getElementById('edit-id').value = id;
            document.getElementById('edit-title').value = announcement.announcement_title;
            document.getElementById('edit-content').value = announcement.announcement_content;
            document.getElementById('edit-priority').value = announcement.announcement_priority;
            document.getElementById('edit-active').checked = announcement.announcement_active;
            
            document.getElementById('edit-modal').classList.remove('hidden');
        }

        // Update announcement
        document.getElementById('edit-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const updateBtn = document.getElementById('update-btn');
            const originalText = updateBtn.textContent;
            
            updateBtn.textContent = 'Updating...';
            updateBtn.disabled = true;
            
            try {
                // Check SDK availability
                if (!window.dataSdk) {
                    showMessage('Data SDK not available. Please refresh the page.', 'error');
                    return;
                }

                const formData = new FormData(e.target);
                const announcement = currentData.find(item => item.__backendId === editingId);
                
                if (!announcement) {
                    showMessage('Announcement not found', 'error');
                    return;
                }
                
                const updatedAnnouncement = {
                    ...announcement,
                    announcement_title: formData.get('title').trim(),
                    announcement_content: formData.get('content').trim(),
                    announcement_priority: formData.get('priority'),
                    announcement_active: formData.has('active')
                };
                
                const result = await window.dataSdk.update(updatedAnnouncement);
                
                if (result.isOk) {
                    showMessage('Announcement updated successfully!', 'success');
                    closeModal();
                } else {
                    showMessage('Failed to update announcement: ' + result.error.message, 'error');
                }
                
            } catch (error) {
                showMessage('Error updating announcement: ' + error.message, 'error');
            } finally {
                updateBtn.textContent = originalText;
                updateBtn.disabled = false;
            }
        });

        // Delete announcement
        async function deleteAnnouncement(id) {
            const announcement = currentData.find(item => item.__backendId === id);
            if (!announcement) return;
            
            // Create inline confirmation
            const announcementElement = document.querySelector(`[data-id="${id}"]`);
            const deleteBtn = announcementElement.querySelector('.delete-btn');
            const originalContent = deleteBtn.innerHTML;
            
            deleteBtn.innerHTML = 'Confirm Delete?';
            deleteBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
            deleteBtn.classList.add('bg-red-600', 'animate-pulse');
            
            // Create cancel button
            const cancelBtn = document.createElement('button');
            cancelBtn.textContent = 'Cancel';
            cancelBtn.className = 'bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded-lg text-sm font-medium transition-colors ml-2';
            
            const buttonContainer = deleteBtn.parentElement;
            buttonContainer.appendChild(cancelBtn);
            
            // Handle confirmation
            const confirmDelete = async () => {
                deleteBtn.innerHTML = '<div class="loading-spinner"></div>';
                deleteBtn.disabled = true;
                
                try {
                    // Check SDK availability
                    if (!window.dataSdk) {
                        showMessage('Data SDK not available. Please refresh the page.', 'error');
                        resetDeleteButton();
                        return;
                    }

                    const result = await window.dataSdk.delete(announcement);
                    
                    if (result.isOk) {
                        showMessage('Announcement deleted successfully!', 'success');
                    } else {
                        showMessage('Failed to delete announcement: ' + result.error.message, 'error');
                        resetDeleteButton();
                    }
                } catch (error) {
                    showMessage('Error deleting announcement: ' + error.message, 'error');
                    resetDeleteButton();
                }
            };
            
            const resetDeleteButton = () => {
                deleteBtn.innerHTML = originalContent;
                deleteBtn.disabled = false;
                deleteBtn.classList.remove('bg-red-600', 'animate-pulse');
                deleteBtn.classList.add('bg-red-500', 'hover:bg-red-600');
                cancelBtn.remove();
                deleteBtn.onclick = () => deleteAnnouncement(id);
            };
            
            deleteBtn.onclick = confirmDelete;
            cancelBtn.onclick = resetDeleteButton;
            
            // Auto-cancel after 5 seconds
            setTimeout(resetDeleteButton, 5000);
        }

        // Toggle announcement status
        async function toggleStatus(id) {
            const announcement = currentData.find(item => item.__backendId === id);
            if (!announcement) return;

            // Check SDK availability
            if (!window.dataSdk) {
                showMessage('Data SDK not available. Please refresh the page.', 'error');
                return;
            }
            
            const updatedAnnouncement = {
                ...announcement,
                announcement_active: !announcement.announcement_active
            };
            
            try {
                const result = await window.dataSdk.update(updatedAnnouncement);
                
                if (result.isOk) {
                    const status = updatedAnnouncement.announcement_active ? 'activated' : 'deactivated';
                    showMessage(`Announcement ${status} successfully!`, 'success');
                } else {
                    showMessage('Failed to update status: ' + result.error.message, 'error');
                }
            } catch (error) {
                showMessage('Error updating status: ' + error.message, 'error');
            }
        }

        // Render announcements
        function renderAnnouncements(data) {
            const container = document.getElementById('announcements-list');
            const emptyState = document.getElementById('empty-state');
            
            // Apply filters
            const filteredData = applyFilters(data);
            
            if (filteredData.length === 0) {
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }
            
            container.classList.remove('hidden');
            emptyState.classList.add('hidden');
            
            // Sort by priority and date
            const sortedData = filteredData.sort((a, b) => {
                const priorityOrder = { urgent: 0, important: 1, general: 2, event: 3 };
                const priorityDiff = priorityOrder[a.announcement_priority] - priorityOrder[b.announcement_priority];
                if (priorityDiff !== 0) return priorityDiff;
                return new Date(b.announcement_date) - new Date(a.announcement_date);
            });
            
            container.innerHTML = sortedData.map(announcement => `
                <div class="announcement-item ${announcement.announcement_priority} bg-white p-6 rounded-xl border shadow-sm" data-id="${announcement.__backendId}">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-3">
                                <span class="priority-${announcement.announcement_priority} px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide">
                                    ${getPriorityIcon(announcement.announcement_priority)} ${announcement.announcement_priority}
                                </span>
                                <span class="text-sm text-gray-500">
                                    ${formatDate(announcement.announcement_date)}
                                </span>
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${announcement.announcement_active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                    ${announcement.announcement_active ? 'Active' : 'Inactive'}
                                </span>
                            </div>
                            <h3 class="text-lg font-bold text-gray-800 mb-2">${announcement.announcement_title}</h3>
                            <p class="text-gray-600 leading-relaxed">${announcement.announcement_content}</p>
                        </div>
                        <div class="flex items-center space-x-2 ml-4">
                            <button onclick="toggleStatus('${announcement.__backendId}')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-sm font-medium transition-colors">
                                ${announcement.announcement_active ? 'Deactivate' : 'Activate'}
                            </button>
                            <button onclick="editAnnouncement('${announcement.__backendId}')" class="bg-indigo-500 hover:bg-indigo-600 text-white px-3 py-1 rounded-lg text-sm font-medium transition-colors">
                                Edit
                            </button>
                            <button onclick="deleteAnnouncement('${announcement.__backendId}')" class="delete-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-sm font-medium transition-colors">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Apply filters
        function applyFilters(data) {
            const priorityFilter = document.getElementById('filter-priority').value;
            const statusFilter = document.getElementById('filter-status').value;
            
            return data.filter(announcement => {
                const matchesPriority = !priorityFilter || announcement.announcement_priority === priorityFilter;
                const matchesStatus = !statusFilter || 
                    (statusFilter === 'active' && announcement.announcement_active) ||
                    (statusFilter === 'inactive' && !announcement.announcement_active);
                
                return matchesPriority && matchesStatus;
            });
        }

        // Update statistics
        function updateStats(data) {
            const total = data.length;
            const active = data.filter(a => a.announcement_active).length;
            const urgent = data.filter(a => a.announcement_priority === 'urgent').length;
            
            // Calculate recent (this week)
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            const recent = data.filter(a => new Date(a.announcement_date) >= oneWeekAgo).length;
            
            document.getElementById('total-count').textContent = total;
            document.getElementById('active-count').textContent = active;
            document.getElementById('urgent-count').textContent = urgent;
            document.getElementById('recent-count').textContent = recent;
        }

        // Utility functions
        function getPriorityIcon(priority) {
            const icons = {
                urgent: 'üö®',
                important: '‚≠ê',
                general: 'üì¢',
                event: 'üìÖ'
            };
            return icons[priority] || 'üì¢';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 1) {
                return 'Today';
            } else if (diffDays === 2) {
                return 'Yesterday';
            } else if (diffDays <= 7) {
                return `${diffDays - 1} days ago`;
            } else {
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            }
        }

        function showMessage(message, type) {
            const container = document.getElementById('message-container');
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
            messageDiv.textContent = message;
            
            container.innerHTML = '';
            container.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        function hideLoading() {
            document.getElementById('loading-state').classList.add('hidden');
        }

        function closeModal() {
            document.getElementById('edit-modal').classList.add('hidden');
            editingId = null;
        }

        // Event listeners
        document.getElementById('close-modal').addEventListener('click', closeModal);
        document.getElementById('cancel-edit').addEventListener('click', closeModal);
        document.getElementById('edit-modal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        // Filter event listeners
        document.getElementById('filter-priority').addEventListener('change', () => {
            renderAnnouncements(currentData);
        });

        document.getElementById('filter-status').addEventListener('change', () => {
            renderAnnouncements(currentData);
        });

        // Fade in animation
        const observer = new IntersectionObserver(function(entries) {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.fade-in').forEach(el => {
            observer.observe(el);
        });

        // Element SDK implementation
        const defaultConfig = {
            admin_title: "Announcements Admin Panel",
            school_name: "Dr. Alfredo Pio De Roda School"
        };

        async function onConfigChange(config) {
            document.getElementById('admin-title').textContent = config.admin_title || defaultConfig.admin_title;
            document.getElementById('school-name').textContent = config.school_name || defaultConfig.school_name;
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["admin_title", config.admin_title || defaultConfig.admin_title],
                ["school_name", config.school_name || defaultConfig.school_name]
            ]);
        }

        // Initialize Element SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities,
                mapToEditPanelValues
            });
        }

        // Initialize the application when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Small delay to ensure SDK is loaded
            setTimeout(initializeApp, 100);
        });

        // Also try immediate initialization in case DOM is already loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(initializeApp, 100);
            });
        } else {
            setTimeout(initializeApp, 100);
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a000178452c81c0',t:'MTc2MzM5MDY2Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
